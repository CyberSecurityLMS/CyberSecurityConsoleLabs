### Инструкция для студентов:

1. Ваша задача - исправить уязвимость в файле `vulnerable_app.py`, добавив механизм синхронизации.
2. Основные требования:
   - Используйте `threading.Lock` для защиты критической секции
   - Объедините проверку и использование файла в атомарную операцию
   - Убедитесь, что файл создается безопасно при необходимости
   - Уберите задержки из критической секции

3. После исправления запустите тесты:
   ```bash
   pytest test_race_condition.py -v
   ```

4. Все тесты должны пройти успешно:
   - Должна быть реализована блокировка
   - Проверка и использование файла должны быть атомарными
   - Не должно быть задержек в критической секции

5. Для проверки можно запускать приложение:
   ```bash
   python vulnerable_app.py 5  # Запуск с 5 потоками
   ```

Тесты проверяют как наличие механизмов синхронизации, так и корректность их использования для защиты от гонки состояний.