# Уязвимость 2: Отсутствие контроля доступа (Access Control Issues)

Это задание демонстрирует уязвимость, при которой пользователь с низкими правами (user) может выполнить действие, предназначенное только для пользователя с высокими правами (admin), из-за отсутствия проверки роли.

## Файлы

*   `vulnerable_app.py`: Уязвимое приложение, где функция `delete_user` не проверяет роль вызывающего.
*   `fixed_app.py`: Исправленное приложение, где `delete_user` принимает роль вызывающего и проверяет, является ли он 'admin'.

## Описание уязвимости

В `vulnerable_app.py` функция `delete_user` отвечает за удаление пользователей из системы. Это критически важное действие, которое должно быть доступно только администраторам. Однако в коде функции отсутствует проверка роли пользователя, который ее вызывает:

```python
# vulnerable_app.py
def delete_user(username_to_delete):
    # УЯЗВИМОСТЬ: Нет проверки роли текущего пользователя!
    if username_to_delete in USERS:
        del USERS[username_to_delete]
        # ...
```
Любой пользователь, успешно прошедший аутентификацию (функция `login`), может вызвать `delete_user` и удалить любого другого пользователя, включая администратора.

## Эксплуатация

1.  **Запустите приложение от имени администратора (alice), чтобы удалить обычного пользователя (bob):**
    ```bash
    python vulnerable_app.py alice password123 bob
    ```
    Вывод покажет, что bob удален. Это ожидаемое поведение.

2.  **Запустите приложение от имени обычного пользователя (bob), чтобы удалить администратора (alice):**
    ```bash
    python vulnerable_app.py bob password456 alice
    ```
    Вывод покажет, что **alice удалена!** Это демонстрирует уязвимость: пользователь bob смог выполнить административное действие.

## Исправление

Уязвимость устранена в `fixed_app.py` путем добавления проверки прав доступа в функции `delete_user`.

1.  Функция `delete_user` теперь принимает дополнительный аргумент `caller_role` (роль пользователя, который ее вызывает).
2.  В начале функции добавлена проверка: если `caller_role` не 'admin', выполнение прерывается с сообщением об ошибке.

```python
# fixed_app.py
def delete_user(caller_role, username_to_delete):
    # ИСПРАВЛЕНО: Добавлена проверка роли текущего пользователя
    if caller_role != "admin":
        print("Ошибка доступа: Только администраторы могут удалять пользователей.")
        return
    # ... (остальная логика)
```
3.  При вызове `delete_user` из основного блока кода теперь передается роль аутентифицированного пользователя:
    ```python
    # fixed_app.py
    current_user_data = login(login_user_name, login_pass)
    if current_user_data:
        delete_user(current_user_data['role'], user_to_delete)
    ```

## Проверка исправления

1.  **Запустите исправленное приложение от имени администратора (alice), чтобы удалить обычного пользователя (bob):**
    ```bash
    python fixed_app.py alice password123 bob
    ```
    Вывод покажет, что bob удален. Административные действия по-прежнему работают.

2.  **Запустите исправленное приложение от имени обычного пользователя (bob), чтобы попытаться удалить администратора (alice):**
    ```bash
    python fixed_app.py bob password456 alice
    ```
    Вывод покажет: **"Ошибка доступа: Только администраторы могут удалять пользователей."** Администратор alice не будет удален. Исправление работает. 